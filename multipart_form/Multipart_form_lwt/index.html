<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Multipart_form_lwt (multipart_form.Multipart_form_lwt)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">multipart_form</a> &#x00BB; Multipart_form_lwt</nav><h1>Module <code>Multipart_form_lwt</code></h1><nav class="toc"><ul><li><a href="#streaming-api.">Streaming API.</a></li><li><a href="#non-streaming-api.">Non-streaming API.</a></li></ul></nav></header><section><header><h4 id="streaming-api."><a href="#streaming-api." class="anchor"></a>Streaming API.</h4></header><dl><dt class="spec value" id="val-stream"><a href="#val-stream" class="anchor"></a><code><span class="keyword">val</span> stream : <span>?&#8288;bounds:int</span> <span>&#45;&gt;</span> <span>identify:<span>(<a href="../Multipart_form/Header/index.html#type-t">Multipart_form.Header.t</a> <span>&#45;&gt;</span> <span class="type-var">'id</span>)</span></span> <span>&#45;&gt;</span> <span>string Lwt_stream.t</span> <span>&#45;&gt;</span> <a href="../Multipart_form/Content_type/index.html#type-t">Multipart_form.Content_type.t</a> <span>&#45;&gt;</span> <span>[ <span>`Parse of <span><span><span>(<span><span class="type-var">'id</span> <a href="../Multipart_form/index.html#type-t">Multipart_form.t</a></span>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> Stdlib.result</span> Lwt.t</span></span> ]</span> * <span><span>(<span class="type-var">'id</span> * <a href="../Multipart_form/Header/index.html#type-t">Multipart_form.Header.t</a> * <span>string Lwt_stream.t</span>)</span> Lwt_stream.t</span></code></dt><dd><p><code>stream ~identify src content_type</code> returns:</p><ul><li>a promise <code>th</code> about the parser</li><li>a stream <code>stream</code> of parts</li></ul><p>They can be manipulated with <code>Lwt.both</code>, and, by this way, ensure a real stream between the parser <code>th</code> and the process which saves parts.</p><p>Assume that you have a function to save a <code>Lwt_stream.t</code> into a <code>filename</code>:</p><pre><code class="ml">val save_part : filename:string -&gt; Header.t -&gt; string Lwt_stream.t -&gt;
  unit Lwt.t</code></pre><p>You can use it with <code>stream</code> like:</p><pre><code class="ml">let identify _ : string = random_unique_filename () in
let `Parse th, stream = stream ~identify src content_type in
let rec saves () = Lwt_stream.get stream &gt;&gt;= function
  | None -&gt; Lwt.return_unit
  | Some (filename, hdr, contents) -&gt;
    save_part ~filename hdr contents &gt;&gt;= fun () -&gt;
    saves () in
Lwt.both th (saves ()) &gt;&gt;= fun (res, ()) -&gt; Lwt.return res</code></pre><p>By this way, as long as we parse <code>src</code>, at the same time, we save parts into filenames. Finally, we return the <code>multipart/form</code> structure with a mapping between temporary files and parts.</p></dd></dl></section><section><header><h4 id="non-streaming-api."><a href="#non-streaming-api." class="anchor"></a>Non-streaming API.</h4><p>These functions will store the entire multipart contents in memory, and therefore should not be used when handling possibly large data.</p></header><dl><dt class="spec value" id="val-of_stream_to_list"><a href="#val-of_stream_to_list" class="anchor"></a><code><span class="keyword">val</span> of_stream_to_list : <span>string Lwt_stream.t</span> <span>&#45;&gt;</span> <a href="../Multipart_form/Content_type/index.html#type-t">Multipart_form.Content_type.t</a> <span>&#45;&gt;</span> <span><span><span>(<span>int <a href="../Multipart_form/index.html#type-t">Multipart_form.t</a></span> * <span><span>(int * string)</span> list</span>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p>Similar to <code>Multipart_form.of_stream_to_list</code>, but consumes a <code>Lwt_stream.t</code>.</p></dd></dl><dl><dt class="spec value" id="val-of_stream_to_tree"><a href="#val-of_stream_to_tree" class="anchor"></a><code><span class="keyword">val</span> of_stream_to_tree : <span>string Lwt_stream.t</span> <span>&#45;&gt;</span> <a href="../Multipart_form/Content_type/index.html#type-t">Multipart_form.Content_type.t</a> <span>&#45;&gt;</span> <span><span><span>(<span>string <a href="../Multipart_form/index.html#type-t">Multipart_form.t</a></span>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>of_stream_to_tree stream content_type</code> returns, if it succeeds, a value <code>t</code> representing the multipart document, where the contents of the parts are stored as strings. It is equivalent to <code>of_stream_to_list</code> where references have been replaced with their associated contents.</p></dd></dl></section></div></body></html>